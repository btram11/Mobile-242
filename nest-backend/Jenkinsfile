pipeline{
    agent any

    stages{
        stage('SSH'){
            steps{
                def remote = [:]
                remote.name = 'backend-vm'
                remote.host = 'meomeo-backend.southeastasia.cloudapp.azure.com'
                remote.user = 'backend-vm'
                remote.identity = credentials('backend-vm-ssh-key')
                remote.allowAnyHosts = true

                sshCommand remote: remote, command: 'cd /app/backend && git pull && npm install'
                sshCommand remote: remote, command: 'systemctl restart nest-backend.service'
            }
        }
    }
}